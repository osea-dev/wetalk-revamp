---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import { Image } from "astro:assets";
import { gsap } from "gsap";
---

<script>
	import { gsap } from "gsap";
	import { ExpoScaleEase } from "gsap/EasePack";
	gsap.registerPlugin(ExpoScaleEase);

	document.addEventListener("DOMContentLoaded", () => {
		const circles = document.querySelectorAll(".circle");
		const cloud = document.querySelector(".cloud");
		const button = document.getElementById("openNowButton");
		const container = document.getElementById("animationContainer");
		const targetSection = document.getElementById("targetSection");

		gsap.timeline({ repeat: -1, yoyo: true }).to(circles, {
			scale: 1.1,
			duration: 5,
			ease: "power2.inOut",
			stagger: {
				each: 0.3,
				yoyo: true,
				repeat: -1,
			},
		});

		if (button) {
			button.addEventListener("click", () => {
				if (cloud && container && targetSection) {
					// Initially hide the target section
					targetSection.style.display = "none";
					targetSection.classList.remove("hidden");

					// Create a GSAP timeline for the animations
					const tl = gsap.timeline();

					// Animate the circles, cloud, and container
					tl.to([circles, cloud, container], {
						scale: 3, // Scale everything except the button
						duration: 1.5, // Animation duration
						ease: "power2.out", // Smooth easing
						opacity: 0.1, // Fade out effect
					});

					// Fade out the button without scaling it
					gsap.to(button, {
						duration: 0.5, // Faster fade-out for the button
						opacity: 0, // Fade out completely
						onComplete: () => {
							// Hide the animation container after the animations complete
							container.style.display = "none";

							// Display the target section
							targetSection.style.display = "block";

							// Scroll to the target section smoothly
							targetSection.scrollIntoView({
								behavior: "smooth",
								block: "start",
							});
						},
					});

					// Animate the button, circles, cloud, and container
					// tl.to([button, circles, cloud, container], {
					// 	scale: 3, // Scale everything up by 3 times
					// 	duration: 1.5, // Animation duration
					// 	ease: "power2.out", // Smooth easing
					// 	opacity: .2, // Fade out effect
					// 	onComplete: () => {
					// 		// Hide the animation container after the animation completes
					// 		container.style.display = "none";

					// 		// Display the target section
					// 		targetSection.style.display = "block";

					// 		// Scroll to the target section smoothly
					// 		targetSection.scrollIntoView({
					// 			behavior: "smooth",
					// 			block: "start",
					// 		});
					// 	},
					// });
				}
			});
		}
	});
</script>

<Layout title="Welcome to Astro.">
	<main>
		<section id="animationContainer">
			<div
				class="bg-[#cff1f9] h-screen overflow-y-hidden flex items-center justify-center"
			>
				<div class="absolute top-10">
					<div class="flex justify-center">
						<img
							src="/img/logo-black.png"
							alt="logo_white"
							class="h-28"
						/>
					</div>
				</div>

				<div
					class="absolute flex flex-col items-center justify-between space-y-8"
				>
					<div
						class="relative w-[28rem] h-[28rem] flex items-center justify-center"
					>
						<div
							class="circle absolute w-full h-full border border-yellow-500 rounded-full"
						>
						</div>
						<div
							class="circle absolute w-[18.5rem] h-[18.5rem] border border-yellow-500 rounded-full"
						>
						</div>
						<div
							class="circle absolute w-[18rem] h-[18rem] border border-yellow-500 rounded-full"
						>
						</div>
						<div
							class="circle absolute w-[12.5rem] h-[12.5rem] border border-yellow-500 rounded-full"
						>
						</div>
						<div
							id="openNowButton"
							class="relative w-[12rem] h-[12rem] flex items-center justify-center border border-yellow-500 rounded-full cursor-pointer"
						>
							<span
								class="text-sm font-medium text-gray-600 hover:bg-white rounded-md border border-gray-400 p-4"
								>Open Now</span
							>
						</div>
					</div>
					<button
						class="z-10 mt-4 py-2 px-6 border border-gray-400 rounded-full text-gray-600 hover:bg-gray-100 transition"
					>
						Skip
					</button>
				</div>
				<div class="flex justify-between">
					<div class="w-1/2 pt-[28rem]">
						<img
							src="/img/entry-animate/cloud-1.png"
							alt="cloud"
							class="circle"
						/>
					</div>

					<div class="w-1/2 pt-[25rem]">
						<img
							src="/img/entry-animate/cloud-4.png"
							alt="cloud"
							class="circle"
						/>
					</div>
				</div>
			</div>

			<div class="absolute bottom-0 left-0 w-full">
				<img
					src="/img/entry-animate/cloud-0.png"
					alt="cloud"
					class="cloud w-full bg-cover"
					style="height: auto; max-height: 20%;"
				/>
			</div>

			<div
				class="absolute bottom-0 left-0 pr-[25rem] pb-[8rem] w-full flex justify-end"
			>
				<img
					src="/img/entry-animate/sign-off.png"
					alt="sign-off"
					class="h-[12rem]"
				/>
			</div>
		</section>

		<section id="targetSection" class="bg-[#cff1f9] hidden h-screen">
			<img src="/img/index/kong/kongzi.png" class="h-48" />
			<div class="absolute flex justify-end">
				<img src="/img/index/kong/kongzizi.png" />
			</div>
		</section>
	</main>
</Layout>

<style></style>
